<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>mongolstats Debugging Findings • mongolstats</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Inter-0.4.10/font.css" rel="stylesheet"><link href="deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet"><link href="deps/Inter_Tight-0.4.10/font.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="mongolstats Debugging Findings"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">mongolstats</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="articles/getting-started.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/discovery.html">Discovering tables and variables</a></li>
    <li><a class="dropdown-item" href="articles/query-builder.html">Query builder</a></li>
    <li><a class="dropdown-item" href="articles/fetching-periods.html">Fetching data and periods</a></li>
    <li><a class="dropdown-item" href="articles/batch-workflows.html">Batch fetching workflows</a></li>
    <li><a class="dropdown-item" href="articles/parallel-batching.html">Parallel batching</a></li>
    <li><a class="dropdown-item" href="articles/offline-caching.html">Offline &amp; caching</a></li>
    <li><a class="dropdown-item" href="articles/mapping.html">Mapping with mongolstats</a></li>
    <li><a class="dropdown-item" href="articles/fuzzy-joins.html">Fuzzy name joins</a></li>
    <li><a class="dropdown-item" href="articles/code-joins.html">Code-based joins</a></li>
    <li><a class="dropdown-item" href="articles/troubleshooting.html">Troubleshooting</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/temuulene/mongolstats" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>mongolstats Debugging Findings</h1>
      <small class="dont-index">Source: <a href="https://github.com/temuulene/mongolstats/blob/main/DEBUGGING_FINDINGS.md" class="external-link"><code>DEBUGGING_FINDINGS.md</code></a></small>
    </div>

<div id="mongolstats-debugging-findings" class="section level1">

<div class="section level2">
<h2 id="issue-summary">Issue Summary<a class="anchor" aria-label="anchor" href="#issue-summary"></a></h2>
<p>Vignettes failing with error: <code>PXWeb request failed with HTTP error</code></p>
</div>
<div class="section level2">
<h2 id="root-causes-identified">Root Causes Identified<a class="anchor" aria-label="anchor" href="#root-causes-identified"></a></h2>
<div class="section level3">
<h3 id="id_-resolved-table-index-is-up-to-date">✅ RESOLVED: Table Index is Up-to-Date<a class="anchor" aria-label="anchor" href="#id_-resolved-table-index-is-up-to-date"></a></h3>
<ul><li>
<strong>Finding</strong>: DT_NSO_0300_001V2 EXISTS in <code>inst/extdata/px_index.json</code> (1183 entries total)</li>
<li>
<strong>Status</strong>: Not an issue</li>
</ul></div>
<div class="section level3">
<h3 id="id_-verified-pxweb-api-is-accessible">✅ VERIFIED: PXWeb API is Accessible<a class="anchor" aria-label="anchor" href="#id_-verified-pxweb-api-is-accessible"></a></h3>
<ul><li>
<strong>Finding</strong>: API at <a href="https://data.1212.mn/api/v1" class="external-link uri">https://data.1212.mn/api/v1</a> is responding correctly</li>
<li>
<strong>Test</strong>: Successfully retrieved metadata for DT_NSO_0300_001V2</li>
<li>
<strong>Status</strong>: Not an issue</li>
</ul></div>
<div class="section level3">
<h3 id="id_️-critical-pxweb-variable-codes-are-in-mongolian">⚠️ CRITICAL: PXWeb Variable Codes are in Mongolian<a class="anchor" aria-label="anchor" href="#id_%EF%B8%8F-critical-pxweb-variable-codes-are-in-mongolian"></a></h3>
<ul><li>
<strong>Finding</strong>: Variable <code>code</code> field uses Mongolian Cyrillic, not English
<ul><li>Example: <code>code: "Хүйс"</code> (Mongolian) vs <code>text: "Sex"</code> (English)</li>
</ul></li>
<li>
<strong>Impact</strong>: POST queries MUST use Mongolian codes in query JSON</li>
<li>
<strong>Package Status</strong>: Code at <code>R/pxweb.R:262</code> correctly uses <code>v$code</code> (Mongolian)</li>
<li>
<strong>Conclusion</strong>: This is CORRECT behavior, not a bug</li>
</ul></div>
<div class="section level3">
<h3 id="id_-verified-label-to-code-mapping-works">✅ VERIFIED: Label-to-Code Mapping Works<a class="anchor" aria-label="anchor" href="#id_-verified-label-to-code-mapping-works"></a></h3>
<ul><li>
<strong>Finding</strong>: Code at lines 235-245 correctly:
<ol style="list-style-type: decimal"><li>Matches user selections by English <code>text</code> field</li>
<li>Maps label values to codes via <code>valueTexts</code> → <code>values</code>
</li>
<li>Uses Mongolian <code>code</code> in POST query</li>
</ol></li>
<li>
<strong>Status</strong>: Logic is correct</li>
</ul></div>
<div class="section level3">
<h3 id="id_-verified-cookie-seeding-works">✅ VERIFIED: Cookie Seeding Works<a class="anchor" aria-label="anchor" href="#id_-verified-cookie-seeding-works"></a></h3>
<ul><li>
<strong>Finding</strong>: Lines 220-229 correctly extract <code>rxid</code> cookie via GET request</li>
<li>
<strong>Test</strong>: Manual curl confirmed cookie extraction works</li>
<li>
<strong>Status</strong>: Implementation is correct</li>
</ul></div>
<div class="section level3">
<h3 id="id_️-potential-issue-post-request-format">⚠️ POTENTIAL ISSUE: POST Request Format<a class="anchor" aria-label="anchor" href="#id_%EF%B8%8F-potential-issue-post-request-format"></a></h3>
<ul><li>
<p><strong>Finding</strong>: Manual POST test with correct Mongolian codes SUCCEEDS:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">curl</span> POST with {<span class="st">"code"</span>: <span class="st">"Хүйс"</span>, ...} → Returns JSON data ✓</span></code></pre></div>
</li>
<li><p><strong>Question</strong>: Why might R package POST fail if manual test works?</p></li>
</ul></div>
</div>
<div class="section level2">
<h2 id="successful-manual-test">Successful Manual Test<a class="anchor" aria-label="anchor" href="#successful-manual-test"></a></h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="va">URL</span><span class="op">=</span><span class="st">"https://data.1212.mn/api/v1/en/NSO/Population,%20household/1_Population,%20household/DT_NSO_0300_001V2.px"</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="va">QUERY</span><span class="op">=</span><span class="st">'{</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="st">  "query": [</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="st">    {"code": "Хүйс", "selection": {"filter": "item", "values": ["0"]}},</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="st">    {"code": "Нас", "selection": {"filter": "item", "values": ["0"]}},</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="st">    {"code": "Он", "selection": {"filter": "item", "values": ["0"]}}</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="st">  ],</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="st">  "response": {"format": "json"}</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="st">}'</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> POST <span class="st">"</span><span class="va">$URL</span><span class="st">"</span> <span class="at">-H</span> <span class="st">"Content-Type: application/json"</span> <span class="at">-H</span> <span class="st">"Cookie: rxid=..."</span> <span class="at">-d</span> <span class="st">"</span><span class="va">$QUERY</span><span class="st">"</span></span></code></pre></div>
<p><strong>Result</strong>: <code>{"columns":[...], "data":[{"key":["0","0","0"],"values":["3441598"]}]}</code></p>
<p>✅ Returns population data successfully!</p>
</div>
<div class="section level2">
<h2 id="table-metadata-structure">Table Metadata Structure<a class="anchor" aria-label="anchor" href="#table-metadata-structure"></a></h2>
<p><strong>Table</strong>: DT_NSO_0300_001V2 (RESIDENT POPULATION IN MONGOLIA)</p>
<p><strong>Variables</strong>: 1. <strong>Sex</strong> (Хүйс) - Codes: <code>["0", "1", "2"]</code> - Labels: <code>["Total", "Male", "Female"]</code></p>
<ol start="2" style="list-style-type: decimal"><li>
<strong>Age</strong> (Нас)
<ul><li>Codes: <code>["0", "1", ..., "87"]</code>
</li>
<li>Labels: <code>["Total", "0", "1", ..., "85+"]</code>
</li>
</ul></li>
<li>
<strong>Year</strong> (Он)
<ul><li>Codes: <code>["0", "1", ..., "24"]</code>
</li>
<li>Labels: <code>["2024", "2023", ..., "2000"]</code>
</li>
</ul></li>
</ol></div>
<div class="section level2">
<h2 id="recommended-next-steps">Recommended Next Steps<a class="anchor" aria-label="anchor" href="#recommended-next-steps"></a></h2>
<div class="section level3">
<h3 id="id_1-add-better-error-logging">1. Add Better Error Logging<a class="anchor" aria-label="anchor" href="#id_1-add-better-error-logging"></a></h3>
<p>Update <code>R/pxweb.R</code> to log: - Exact URL being POSTed - Full request body - Full response body (not just status code)</p>
</div>
<div class="section level3">
<h3 id="id_2-test-with-r-package-directly">2. Test with R Package Directly<a class="anchor" aria-label="anchor" href="#id_2-test-with-r-package-directly"></a></h3>
<p>Run <code>debug_full_flow.R</code> to see actual error from R</p>
</div>
<div class="section level3">
<h3 id="id_3-check-response-format">3. Check Response Format<a class="anchor" aria-label="anchor" href="#id_3-check-response-format"></a></h3>
<p>Line 268: <code>response = list(format = "JSON")</code> uses uppercase “JSON” - Manual test showed lowercase <code>"json"</code> works - Try changing to lowercase</p>
</div>
<div class="section level3">
<h3 id="id_4-verify-url-encoding">4. Verify URL Encoding<a class="anchor" aria-label="anchor" href="#id_4-verify-url-encoding"></a></h3>
<p>The px_path contains special characters: - <code>"Population, household/1_Population, household"</code> - Ensure comma and space are properly encoded</p>
</div>
<div class="section level3">
<h3 id="id_5-consider-response-format-options">5. Consider Response Format Options<a class="anchor" aria-label="anchor" href="#id_5-consider-response-format-options"></a></h3>
<p>Test if API accepts: - <code>"json"</code> (lowercase) - <code>"JSON"</code> (uppercase) - <code>"json-stat2"</code> - No format specified</p>
</div>
</div>
<div class="section level2">
<h2 id="files-to-update">Files to Update<a class="anchor" aria-label="anchor" href="#files-to-update"></a></h2>
<ol style="list-style-type: decimal"><li>
<strong>R/pxweb.R</strong>
<ul><li>Line 268: Try lowercase <code>"json"</code> instead of <code>"JSON"</code>
</li>
<li>Lines 296-313: Add detailed error logging</li>
</ul></li>
<li>
<strong>Vignettes</strong>
<ul><li>Once POST working, verify all examples use valid tables</li>
<li>Add error handling with informative messages</li>
</ul></li>
<li>
<strong>Tests</strong>
<ul><li>Add integration tests with real API calls</li>
<li>Test label→code mapping explicitly</li>
</ul></li>
</ol></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Temuulen Enebish.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>


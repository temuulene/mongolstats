<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>NA • mongolstats</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Inter-0.4.10/font.css" rel="stylesheet"><link href="deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet"><link href="deps/Inter_Tight-0.4.10/font.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="NA"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">mongolstats</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="articles/getting-started.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/getting-started.html">Getting started</a></li>
    <li><a class="dropdown-item" href="articles/discovery.html">Discovering tables and variables</a></li>
    <li><a class="dropdown-item" href="articles/fetching-periods.html">Fetching data and periods</a></li>
    <li><a class="dropdown-item" href="articles/batch-workflows.html">Batch fetching workflows</a></li>
    <li><a class="dropdown-item" href="articles/mapping.html">Mapping with mongolstats</a></li>
    <li><a class="dropdown-item" href="articles/fuzzy-joins.html">Fuzzy name joins</a></li>
    <li><a class="dropdown-item" href="articles/code-joins.html">Code-based joins</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/temuulene/mongolstats" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>NA</h1>
      <small class="dont-index">Source: <a href="https://github.com/temuulene/mongolstats/blob/main/agents.md" class="external-link"><code>agents.md</code></a></small>
    </div>


<p>Agents Guide</p>
<p>This document provides guidance for AI coding agents working in this repository. It summarizes major features, how they work, and the files involved so agents can navigate and extend the codebase efficiently.</p>
<p>Overview</p>
<p>mongolstats is an R package that offers a tidyverse-friendly client for the National Statistics Office of Mongolia (NSO) open data via the PXWeb API (data.1212.mn) and utilities for working with Mongolia administrative boundaries as sf. The package focuses on ergonomic discovery, data access, and mapping workflows.</p>
<p>Key entry points: - Package metadata: DESCRIPTION, NAMESPACE, README.md - R sources: R/ - Vignettes: vignettes/ - Tests: tests/testthat/ - Prebuilt PX index: inst/extdata/px_index.json - Helper scripts: tools/</p>
<p>Major Features</p>
<ol style="list-style-type: decimal"><li>PXWeb Table Discovery and Variables</li>
</ol><ul><li>nso_itms() lists available PXWeb tables with IDs, English/Mongolian titles, and inferred period ranges.</li>
<li>nso_variables(tbl_id) returns a tidy codebook (field, item code, English and Mongolian labels) for a given table.</li>
<li>Sector navigation: nso_sectors() (top level), nso_subsectors(id) (children).</li>
<li>Search helpers: nso_itms_search(query) and nso_search(query, sector).</li>
</ul><ol start="2" style="list-style-type: decimal"><li>Data Fetching (PXWeb)</li>
</ol><ul><li>nso_data(tbl_id, selections, labels) fetches data by selecting values for each dimension using codes or labels; returns a tibble with dimension columns and a numeric value column.</li>
<li>nso_package(requests, labels) batches multiple table requests and row-binds results, adding tbl_id per row.</li>
<li>Optional label enrichment: labels = “none” | “en” | “mn” | “both” adds *_en and/or *_mn columns for each dimension.</li>
</ul><ol start="3" style="list-style-type: decimal"><li>Period Utilities</li>
</ol><ul><li>nso_period_seq(start, end, by = “Y” | “M”) builds yearly or monthly codes (YYYY / YYYYMM).</li>
<li>nso_table_periods(tbl_id) inspects table metadata to derive valid period labels for that table.</li>
</ul><ol start="4" style="list-style-type: decimal"><li>Geography and Joins</li>
</ol><ul><li>mn_boundaries(level = “ADM0” | “ADM1” | “ADM2”) downloads Mongolia administrative boundaries as sf via the GeoBoundaries API.</li>
<li>mn_boundaries_normalize(g, name_col) adds normalized name_std for robust matching.</li>
<li>mn_join_by_name(data, name_col, level, boundaries) exact-joins tabular data to boundaries by normalized names.</li>
<li>mn_fuzzy_join_by_name(…, max_distance, method) fuzzy-joins using string distance; powered by stringdist when available.</li>
<li>mn_boundary_keys(level) returns a tidy crosswalk of boundary keys (shapeID, shapeName, shapeISO, name_std).</li>
</ul><ol start="5" style="list-style-type: decimal"><li>Caching</li>
</ol><ul><li>nso_cache_enable(dir) enables on-disk memoization for table lists, codebooks, and PXWeb metadata using memoise/cachem under rappdirs::user_cache_dir(“mongolstats”)/v1 by default.</li>
<li>nso_cache_disable() and nso_cache_clear() control cache state.</li>
</ul><ol start="6" style="list-style-type: decimal"><li>Configuration</li>
</ol><ul><li>nso_options(…) wraps base options for mongolstats.* keys: base URLs, PX language (mongolstats.lang), timeouts/retries, verbosity, and default label preference.</li>
<li>Package defaults are set in R/zzz.R on load.</li>
</ul><p>How It Works</p>
<p>PXWeb integration (R/pxweb.R) - URL construction: .px_url() uses mongolstats.px_base_url, language (en/mn), and database (NSO). - Listing/metadata: .px_list() and .px_meta() call PXWeb endpoints via httr2; BOM is stripped and JSON parsed. - Indexing: nso_px_tables() traverses the PXWeb tree; .px_index() prefers the embedded JSON index (inst/extdata/px_index.json) and falls back to live traversal if missing. nso_rebuild_px_index() refreshes and optionally writes the index. - Variables: nso_px_variables(tbl_id) returns bilingual codebooks by merging English and Mongolian metadata. - Data: nso_px_data() builds a PXWeb query from user selections, maps labels to codes when needed, and flattens the response into a tidy tibble. nso_data() and nso_package() wrap this and add optional label columns via .px_add_labels().</p>
<p>HTTP utilities (R/http.R) - Centralized request setup with retry/backoff and a custom User-Agent. .nso_perform() standardizes error handling.</p>
<p>Geography (R/geography.R, R/names.R) - GeoBoundaries API for GeoJSON; name normalization with stringi/stringr enables exact/fuzzy joins.</p>
<p>Caching (R/cache.R) - Memoized wrappers for PXWeb listing/metadata when caching is enabled.</p>
<p>Key Files</p>
<ul><li>PXWeb core: R/pxweb.R, helpers R/aaa_px_helpers.R</li>
<li>Data API wrappers: R/data.R</li>
<li>Discovery/search: R/itms.R, R/sector.R, R/search.R</li>
<li>Geography and joins: R/geography.R, R/names.R</li>
<li>Periods/utilities: R/periods.R, R/utils.R</li>
<li>HTTP utilities: R/http.R</li>
<li>Options and defaults: R/options.R, R/zzz.R, R/globals.R</li>
<li>Caching: R/cache.R</li>
<li>Embedded PX index: inst/extdata/px_index.json</li>
<li>Vignettes: vignettes/*.Rmd (getting started, discovery, periods, batch workflows, mapping, fuzzy/code joins)</li>
<li>Tests: tests/testthat/*.R</li>
<li>Tooling: tools/smoke.R, tools/build_site.R, tools/release_check.R</li>
</ul><p>Development</p>
<p>Testing</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Quick smoke test</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>Rscript tools<span class="sc">/</span>smoke.R</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Run unit tests</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>Rscript <span class="sc">-</span>e <span class="st">"invisible(lapply(list.files('R', full.names=TRUE), source)); library(testthat); test_dir('tests/testthat', reporter='summary')"</span></span></code></pre></div>
<p>Docs/site</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Regenerate Rd docs</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>Rscript <span class="sc">-</span>e <span class="st">"roxygen2::roxygenise()"</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># Build pkgdown site</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>Rscript tools<span class="sc">/</span>build_site.R</span></code></pre></div>
<p>Optional full check (requires rcmdcheck, roxygen2)</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>Rscript <span class="sc">-</span>e <span class="st">"install.packages('roxygen2'); roxygen2::roxygenise()"</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>Rscript <span class="sc">-</span>e <span class="st">"options(crayon.enabled = TRUE); rcmdcheck::rcmdcheck(args = c('--no-manual', '--as-cran'), error_on = 'warning', check_dir = 'check')"</span></span></code></pre></div>
<p>CI/CD and Docs</p>
<ul><li>GitHub Actions for R CMD check and pkgdown site (see badges in README.md).</li>
<li>pkgdown configuration: _pkgdown.yml.</li>
</ul><p>Dependencies</p>
<p>Core: httr2, jsonlite, tibble, dplyr, purrr, stringr, sf, memoise, cachem, rappdirs, stringi, stringdist, curl</p>
<p>Suggested: testthat (&gt;= 3.0.0), knitr, rmarkdown, pkgdown, roxygen2, lifecycle</p>
<p>Notes for Agents</p>
<ul><li>Prefer PXWeb functions (nso_*) for new data access; the low-level HTTP helpers support PXWeb and future endpoints.</li>
<li>Keep functions small, composable, and use a leading dot for non-exported helpers.</li>
<li>If expanding discovery or adding stable geographic code support, update the embedded PX index and consider adding a vignette example.</li>
</ul></main></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Temuulen Enebish.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

